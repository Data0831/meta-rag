<!DOCTYPE html>

<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>RAG Chat Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@300,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#007aff",
                        "background-light": "#ffffff",
                        "background-dark": "#0f1923",
                        "sidebar-light": "#f5f5f7",
                        "sidebar-dark": "#1c1c1e",
                        "border-light": "#e5e5ea",
                        "border-dark": "#38383a",
                        "text-primary-light": "#1c1c1e",
                        "text-primary-dark": "#f2f2f7",
                        "text-secondary-light": "#8e8e93",
                        "text-secondary-dark": "#8e8e93",
                        "bubble-ai-light": "#f2f2f7",
                        "bubble-ai-dark": "#2c2c2e",
                    },
                    fontFamily: {
                        "display": ["Inter", "-apple-system", "BlinkMacSystemFont", "Helvetica Neue", "Arial", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.75rem", /* 12px */
                        "lg": "1.125rem",  /* 18px */
                        "xl": "1.5rem",   /* 24px */
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft': '0 4px 12px rgba(0, 0, 0, 0.08)',
                        'medium': '0 6px 20px rgba(0, 0, 0, 0.1)'
                    }
                },
            },
        }
    </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">
    <div class="flex flex-col h-screen w-full">
        <!-- Tab Bar -->
        <div
            class="flex-shrink-0 bg-[#dee1e6] dark:bg-[#202124] pt-2 px-3 flex items-end justify-between gap-1 border-b border-border-light dark:border-border-dark select-none">
            <!-- Tabs (Left) -->
            <div class="flex items-end gap-1">
                <a href="/chat"
                    class="flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors duration-200 text-text-secondary-light dark:text-text-secondary-dark hover:bg-black/5 dark:hover:bg-white/5 min-w-[120px] justify-center">
                    <span class="material-symbols-outlined text-[18px]">chat_bubble</span>
                    Chat
                </a>
                <a href="/"
                    class="flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors duration-200 text-text-secondary-light dark:text-text-secondary-dark hover:bg-black/5 dark:hover:bg-white/5 min-w-[120px] justify-center">
                    <span class="material-symbols-outlined text-[18px]">science</span>
                    RAG LAB
                </a>
                <a href="/search"
                    class="flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors duration-200 text-text-secondary-light dark:text-text-secondary-dark hover:bg-black/5 dark:hover:bg-white/5 min-w-[120px] justify-center">
                    <span class="material-symbols-outlined text-[18px]">manage_search</span>
                    Vector Search
                </a>
                <a href="/compare"
                    class="flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors duration-200 text-text-secondary-light dark:text-text-secondary-dark hover:bg-black/5 dark:hover:bg-white/5 min-w-[120px] justify-center">
                    <span class="material-symbols-outlined text-[18px]">compare_arrows</span>
                    Compare
                </a>
            </div>

            <!-- Info Badges (Right) -->
            <div class="flex items-center gap-3 pb-2 pr-2 text-[11px] text-text-secondary-light dark:text-text-secondary-dark">
                <!-- Info Badges Removed for Pure Chat Mode -->
            </div>
        </div>

        <!-- Main Content with Sidebar and Chat -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar -->
            <aside
                class="flex-shrink-0 w-[280px] bg-sidebar-light/80 dark:bg-sidebar-dark/80 sidebar-backdrop-blur border-r border-border-light dark:border-border-dark flex flex-col p-2">
                <div class="flex flex-col gap-6 flex-1 overflow-y-auto">

                    <div class="flex flex-col gap-4">


                        <!-- LLM MODEL Section -->
                        <section>
                            <label class="flex flex-col">
                                <p
                                    class="text-xs font-semibold text-text-secondary-light dark:text-text-secondary-dark uppercase tracking-widest px-2 pb-2">
                                    LLM Model</p>
                                <select id="llm-select"
                                    class="form-select w-full rounded-lg border-none bg-[#e9e9eb] dark:bg-[#3a3a3c] text-text-primary-light dark:text-text-primary-dark text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200 h-10">
                                    <option value="gemma3:1b" selected>gemma3:1b (Local)</option>
                                    <option value="gemma3:4b" >gemma3:4b (Local)</option>
                                    <option value="gemini-flash-lite-latest">gemini-flash-lite-latest</option>
                                    <option value="gemini-flash-lite-latest">gemini-flash-lite-latest</option>
                                    <option value="gemini-flash-latest">gemini-flash-latest</option>
                                </select>
                            </label>
                        </section>
                    </div>
                </div>
                <!-- Footer Action -->
                <div class="pt-4 flex-shrink-0">
                    <button id="clear-chat-btn"
                        class="flex w-full items-center justify-center gap-2 px-3 py-2 rounded-lg hover:bg-red-500/10 transition-colors duration-200">
                        <span aria-hidden="true" class="material-symbols-outlined text-red-500 !font-thin">delete</span>
                        <p class="text-red-500 text-sm font-medium">Clear Chat</p>
                    </button>
                </div>
            </aside>
            <!-- Main Chat Area -->
            <main class="flex-1 flex flex-col bg-background-light dark:bg-background-dark overflow-hidden min-w-0">
                <!-- Top Bar -->
                <header class="flex-shrink-0 py-3 px-6 border-b border-border-light dark:border-border-dark">
                    <div class="flex items-center justify-center gap-6 flex-wrap text-xs text-text-secondary-light dark:text-text-secondary-dark">
                        <!-- Token Stats -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined !text-base">summarize</span>
                            <span class="font-medium">Tokens:</span>
                            <span id="token-stats-header" class="font-mono text-primary">0 / 200K</span>
                            <span id="token-percentage-header" class="text-text-secondary-light dark:text-text-secondary-dark">(0%)</span>
                        </div>

                        <!-- Session History Stats -->
                        <div class="flex items-center gap-1.5 border-l border-border-light dark:border-border-dark pl-4" title="Accumulated tokens in conversation memory">
                            <span class="material-symbols-outlined !text-base">history</span>
                            <span class="font-medium">History:</span>
                            <span id="history-token-stats-header" class="font-mono text-purple-600 dark:text-purple-400">0</span>
                        </div>
                    </div>
                </header>
                <!-- Chat Stream -->
                <div id="chat-container" class="flex-1 overflow-y-auto p-6 md:px-12 lg:px-24 space-y-8 scroll-smooth">
                </div>
                <!-- Input Area -->
                <footer class="flex-shrink-0 p-4 md:px-12 lg:px-24">
                    <div class="relative">
                        <input id="chat-input"
                            class="w-full bg-sidebar-light dark:bg-sidebar-dark text-text-primary-light dark:text-text-primary-dark placeholder:text-text-secondary-light dark:placeholder:text-text-secondary-dark border-none rounded-xl h-14 pl-5 pr-16 text-base focus:ring-2 focus:ring-primary/50 transition duration-200"
                            placeholder="Ask anything..." type="text" />
                        <button id="send-btn"
                            class="absolute right-2 top-2 h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-primary/90 transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <span aria-hidden="true" class="material-symbols-outlined !font-thin">arrow_upward</span>
                        </button>
                        <button id="retry-btn" title="Retry Last Message"
                            class="absolute right-14 top-2 h-10 w-10 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-text-primary-light dark:text-text-primary-dark hover:bg-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500/50 opacity-50 cursor-not-allowed" disabled>
                            <span aria-hidden="true" class="material-symbols-outlined !font-thin">refresh</span>
                        </button>
                    </div>
                </footer>
            </main>

            <!-- Right Sidebar - System Prompt Configuration -->
            <aside
                class="flex-shrink-0 w-[320px] bg-sidebar-light/80 dark:bg-sidebar-dark/80 sidebar-backdrop-blur border-l border-border-light dark:border-border-dark flex flex-col p-4">
                <div class="flex flex-col gap-4 h-full">
                    <!-- Header -->
                    <div class="flex items-center gap-2 pb-2 border-b border-border-light dark:border-border-dark">
                        <span class="material-symbols-outlined text-primary !text-xl">edit_note</span>
                        <h3 class="text-sm font-semibold text-text-primary-light dark:text-text-primary-dark">
                            系統提示詞配置
                        </h3>
                    </div>

                    <!-- System Prompt Textarea (Editable Part) -->
                    <div class="flex flex-col gap-2 flex-1 min-h-0">
                        <label class="flex flex-col gap-2 flex-1 min-h-0">
                            <div class="flex items-center justify-between">
                                <p class="text-xs font-medium text-text-secondary-light dark:text-text-secondary-dark">
                                    自定義系統指令（可編輯）
                                </p>
                                <button id="reset-prompt-btn"
                                    class="text-xs text-primary hover:text-primary/80 transition-colors">
                                    重置為預設
                                </button>
                            </div>
                            <textarea id="system-instruction-input"
                                class="flex-1 min-h-0 resize-none rounded-lg border-none bg-[#e9e9eb] dark:bg-[#3a3a3c] text-text-primary-light dark:text-text-primary-dark text-sm leading-relaxed p-3 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200"
                                placeholder="請輸入系統指令...">You are a helpful AI assistant.</textarea>
                        </label>

                        <!-- Character Count -->
                        <div class="flex items-center justify-between text-xs text-text-secondary-light dark:text-text-secondary-dark">
                            <span>字數統計</span>
                            <span id="prompt-char-count" class="font-mono">0 字元</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>

</html>