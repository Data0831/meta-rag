# 關鍵字權重調整指南

本專案採用 **非對稱加權算法 (Asymmetric Weighted Scoring)** 來結合「原始語意分數 (Vector Score)」與「關鍵字命中率 (Keyword Hit Ratio)」。

## 核心公式

```python
Final = Original * (1 - P * (1 - R)) + B * R * (1 - Original)
```

*   **Original**: 原始向量檢索分數 (0.0 ~ 1.0)
*   **R (Ratio)**: 關鍵字命中率 (命中數 / 總關鍵字數)
*   **P (Penalty)**: `NO_HIT_PENALTY_FACTOR` (預設 0.25)
*   **B (Boost)**: `KEYWORD_HIT_BOOST_FACTOR` (預設 0.55)

---

## 參數調整策略

你可以透過修改 `src/config.py` 中的這兩個常數來改變搜尋行為。

### 1. `NO_HIT_PENALTY_FACTOR` (未命中懲罰係數)
**控制當「沒有」關鍵字時，分數要扣多少。**
*   **預設值**: `0.25` (沒命中時，分數打 75 折)
*   **何時調高 (e.g., 0.4)**:
    *   覺得搜尋結果太發散，有很多不相關的內容 (Raw Vector Search 太寬鬆)。
    *   希望使用者**必須**打中至少一個關鍵字才能排在前面。
*   **何時調低 (e.g., 0.1)**:
    *   發現高分且相關的語意結果被過度懲罰，導致好結果消失。
    *   語意檢索準確度很高，不需要太依賴關鍵字過濾。

### 2. `KEYWORD_HIT_BOOST_FACTOR` (命中加分係數)
**控制當「有」關鍵字時，分數要加多少 (尤其是低分文檔)。**
*   **預設值**: `0.55` (命中時，填補 55% 的分數差距)
*   **何時調高 (e.g., 0.8)**:
    *   精準匹配非常重要 (如：查詢 error code, ID)。
    *   希望即使語意分數很低 (0.1)，只要關鍵字全中，就能衝到第一頁 (變成 ~0.6+)。
*   **何時調低 (e.g., 0.3)**:
    *   發現低質量的文檔僅因為包含關鍵字就排在高品質語意文檔前面 (Keyword Stuffing)。

---

## 調整範例對照表

以下為預設值 (`P=0.25`, `B=0.55`) 的效果：

| 原始分數 | 是否命中關鍵字 | 新分數 | 效果描述 |
| :--- | :--- | :--- | :--- |
| **0.1 (低)** | **Hit (100%)** | **0.595** | 大幅提升，讓它有機會被看見 |
| **0.5 (中)** | **Hit (100%)** | **0.775** | 顯著提升 |
| **0.9 (高)** | **Hit (100%)** | **0.955** | 微幅提升 (接近滿分) |
| **0.9 (高)** | **No Hit (0%)**| **0.675** | 微幅懲罰，仍在及格邊緣 |
| **0.5 (中)** | **No Hit (0%)**| **0.375** | 顯著懲罰，掉出前幾名 |

### 比較：若希望更強調「有中關鍵字」
將 `B` 提升至 **0.8**：
*   0.1 + Hit -> **0.82** (直接變高分)

### 比較：若希望更嚴格過濾「沒中關鍵字」
將 `P` 提升至 **0.5**：
*   0.9 + No Hit -> **0.45** (高分文檔沒中關鍵字也會不及格)
